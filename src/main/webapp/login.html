<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>付不起OA办公系统</title>
        <link
                href="assets/element-plus/index.css"
                rel="stylesheet"
                type="text/css"
        />
        <!-- Import Vue 3 -->
        <script src="assets/vue/vue.global.js"></script>
        <script src="assets/element-plus/index.full.js"></script>
        <script src="assets/axios/axios.js"></script>
        <!--        <script src="//cdn.jsdelivr.net/npm/vue@3"></script>-->
        <!-- Import component library -->
        <!--        <script src="//cdn.jsdelivr.net/npm/element-plus"></script>-->
        <style>
            .login-box {
                border: 1px solid #DCDFE6;
                width: 350px;
                margin: 180px auto;
                padding: 35px 35px 15px 35px;
                border-radius: 5px;
                -webkit-border-radius: 5px;
                -moz-border-radius: 5px;
                box-shadow: 0 0 25px #909399;
            }

            .login-title {
                text-align: center;
                margin: 0 auto 40px auto;
                color: #303133;
            }
        </style>
    </head>
    <body>
        <div id="app">
            <el-form :model="form" :rules="rules" class="login-box" label-width="80px" ref="loginForm">
                <h2 class="login-title">付不起OA办公系统</h2>
                <!--                //prop绑定的名字不是属性名，而是rules中的规则名-->
                <el-form-item label="账号" prop="username">
                    <el-input placeholder="请输入账号" type="text" v-model="form.username"/>
                </el-form-item>
                <el-form-item label="密码" prop="password">
                    <el-input placeholder="请输入密码" show-password type="password" v-model="form.password"/>
                </el-form-item>
                <el-form-item>
                    <el-button
                            style="width: 200px"
                            type="primary"
                            v-on:click="onSubmit('loginForm')"
                    >登录
                    </el-button>
                </el-form-item>
            </el-form>
        </div>
    </body>
    <script>
        const Main = {
            data() {
                return {
                    form: {
                        username: ""
                        , password: ""
                    }
                    , rules: {
                        username: [
                            {required: true, message: "账号不能为空", trigger: "blur"}
                        ]
                        , password: [
                            {required: true, message: "密码不能为空", trigger: "blur"}
                        ]
                    }
                }
            }
            , methods: {
                onSubmit(formName) {
                    // 通过formName查找表单的引用
                    const form = this.$refs[formName];
                    //按照规则对表单内容进行校验，valid为true则为校验成功（即用户名和密码不为空）
                    form.validate((valid) => {
                        if (valid) {
                            console.info("表单校验成功");

                            const form = this.form;
                            const $message = this.$message;
                            const params = new URLSearchParams();
                            params.append("username", form.username);
                            params.append("password", form.password);
                            axios.post("/api/login", params, {}).then(function (response) {
                                console.info(response);
                                const json = response.data;
                                if (json.code == "0") {
                                    //使用sessionStorage在浏览器中存储少量信息，在浏览器关闭后消失
                                    sessionStorage.uid = json.data.user.userId;
                                    sessionStorage.eid = json.data.user.employeeId;
                                    window.location.href = "/index.html";
                                } else {
                                    $message.error({message: json.message, offset: 100});
                                }
                            })
                        }
                    })

                }
            }
        };
        //初始化Vue,绑定Main中的数据,利用ElementPlus对#app容器进行重新渲染
        const app = Vue.createApp(Main);
        app.use(ElementPlus);
        app.mount("#app");
    </script>
</html>